package com.example.fatcat.utils

import com.example.fatcat.model.Pet
import com.example.fatcat.model.PetSpeech
import com.example.fatcat.model.PetState
import com.example.fatcat.model.SpeechTrigger
import kotlin.random.Random

/**
 * å® ç‰©è¯´è¯ç”Ÿæˆå™¨
 * æ ¹æ®å® ç‰©çŠ¶æ€å’Œè§¦å‘åŸå› ç”Ÿæˆå¯¹åº”çš„è¯è¯­
 */
object SpeechGenerator {
    
    // é¥¥é¥¿ç›¸å…³è¯è¯­ï¼ˆä½äº30ï¼‰
    private val hungryPhrases = listOf(
        "ä¸»äººï¼Œæˆ‘å¥½é¥¿å•Š~ ğŸ–",
        "è‚šå­å’•å’•å«äº†...",
        "å¥½æƒ³åƒä¸œè¥¿å‘€ï¼",
        "èƒ½ç»™æˆ‘ç‚¹åƒçš„å—ï¼Ÿ",
        "é¥¿å¾—æ²¡åŠ›æ°”äº†...",
        "ä¸»äººï¼Œå–‚æˆ‘åƒçš„å§~",
        "æˆ‘éœ€è¦è¡¥å……èƒ½é‡å•¦ï¼",
        "é£Ÿç‰©ï¼æˆ‘è¦é£Ÿç‰©ï¼ğŸ”"
    )
    
    // éå¸¸é¥¥é¥¿ç›¸å…³è¯è¯­ï¼ˆä½äº20ï¼‰â­ ç´§æ€¥æé†’
    private val veryHungryPhrases = listOf(
        "ä¸»äººï¼Œæˆ‘é¥¿äº†ï¼Œæƒ³åƒå¥½åƒçš„ ğŸ–",
        "ä¸»äººï¼æˆ‘å¿«é¥¿æ™•äº†ï¼Œæ•‘æ•‘æˆ‘ï¼",
        "å¥½é¥¿å¥½é¥¿ï¼æ±‚æ±‚ä¸»äººå–‚æˆ‘å§ï¼ğŸ˜­",
        "é¥¥é¥¿å€¼å‘Šæ€¥ï¼ä¸»äººå¿«æ¥ï¼",
        "å†ä¸åƒä¸œè¥¿å°±è¦é¥¿æ­»äº†... ğŸ¥º",
        "ä¸»äººï¼Œæˆ‘çœŸçš„å¾ˆé¥¿å¾ˆé¥¿äº†ï¼",
        "è‚šå­ç©ºç©ºçš„ï¼Œä¸»äººå¿«ç»™æˆ‘åƒçš„ï¼"
    )
    
    // å£æ¸´ç›¸å…³è¯è¯­ï¼ˆä½äº30ï¼‰
    private val thirstyPhrases = listOf(
        "å¥½æ¸´å•Šï¼Œæƒ³å–æ°´~ ğŸ’§",
        "å£å¥½å¹²...",
        "ä¸»äººï¼Œç»™æˆ‘æ°´å–å§ï¼",
        "éœ€è¦è¡¥å……æ°´åˆ†äº†...",
        "æ¸´å¾—ä¸è¡Œäº†ï¼",
        "æƒ³å–æ°´æ°´~",
        "æ°´ï¼æˆ‘è¦æ°´ï¼ğŸ’¦"
    )
    
    // éå¸¸å£æ¸´ç›¸å…³è¯è¯­ï¼ˆä½äº20ï¼‰â­ ç´§æ€¥æé†’
    private val veryThirstyPhrases = listOf(
        "ä¸»äººï¼Œæˆ‘æ¸´äº†ï¼Œæƒ³å–æ°´æ°´ ğŸ’§",
        "ä¸»äººï¼å¿«æ¸´æ­»äº†ï¼Œç»™æˆ‘æ°´å–ï¼",
        "å¥½æ¸´å¥½æ¸´ï¼æ±‚æ±‚ä¸»äººäº†ï¼ğŸ˜­",
        "å£æ¸´å€¼å‘Šæ€¥ï¼ä¸»äººå¿«æ¥ï¼",
        "å—“å­éƒ½è¦å†’çƒŸäº†... ğŸ¥º",
        "ä¸»äººï¼Œæˆ‘çœŸçš„å¾ˆæ¸´å¾ˆæ¸´äº†ï¼",
        "æ¸´å¾—å—ä¸äº†äº†ï¼Œå¿«ç»™æˆ‘æ°´ï¼"
    )
    
    // ç–²åŠ³ç›¸å…³è¯è¯­ï¼ˆä½äº30ï¼‰
    private val tiredPhrases = listOf(
        "å¥½å›°å•Š...æƒ³ç¡è§‰~ ğŸ˜´",
        "çœ¼çš®æ‰“æ¶äº†...",
        "éœ€è¦ä¼‘æ¯ä¸€ä¸‹...",
        "å¥½ç´¯å‘€ï¼Œè¦ç¡è§‰äº†~",
        "è®©æˆ‘ç¡ä¸€ä¼šå„¿å§...",
        "å›°æ­»äº†...ğŸ’¤",
        "ç²¾ç¥ä¸å¤ªå¥½..."
    )
    
    // éå¸¸ç–²åŠ³ç›¸å…³è¯è¯­ï¼ˆä½äº20ï¼‰â­ ç´§æ€¥æé†’
    private val veryTiredPhrases = listOf(
        "ä¸»äººï¼Œæˆ‘ç´¯äº†ï¼Œæƒ³ä¼‘æ¯ä¸€ä¸‹ ğŸ˜´",
        "ä¸»äººï¼æˆ‘å¿«ç´¯è¶´äº†ï¼Œè®©æˆ‘ç¡è§‰å§ï¼",
        "å¥½ç´¯å¥½ç´¯ï¼æ’‘ä¸ä½äº†ï¼ğŸ˜­",
        "ç²¾åŠ›å€¼å‘Šæ€¥ï¼ä¸»äººå¿«æ¥ï¼",
        "ç²¾ç–²åŠ›å°½äº†... ğŸ¥º",
        "ä¸»äººï¼Œæˆ‘çœŸçš„å¾ˆç´¯å¾ˆç´¯äº†ï¼",
        "ä¸€ç‚¹åŠ›æ°”éƒ½æ²¡æœ‰äº†ï¼Œè®©æˆ‘ç¡è§‰å§ï¼"
    )
    
    // ä¸å¼€å¿ƒç›¸å…³è¯è¯­ï¼ˆä½äº30ï¼‰
    private val unhappyPhrases = listOf(
        "å¿ƒæƒ…ä¸å¤ªå¥½... ğŸ˜¢",
        "æ„Ÿè§‰æœ‰ç‚¹éš¾è¿‡...",
        "ä¸»äººï¼Œé™ªé™ªæˆ‘å§~",
        "ä¸å¼€å¿ƒäº†...",
        "éœ€è¦ä¸»äººçš„å…³çˆ±ï¼",
        "æœ‰ç‚¹å­¤å•...",
        "å‘œå‘œå‘œ...ğŸ˜­"
    )
    
    // éå¸¸ä¸å¼€å¿ƒç›¸å…³è¯è¯­ï¼ˆä½äº20ï¼‰â­ ç´§æ€¥æé†’
    private val veryUnhappyPhrases = listOf(
        "ä¸»äººï¼Œæˆ‘ä¸å¼€å¿ƒï¼Œé™ªé™ªæˆ‘å˜› ğŸ˜¢",
        "ä¸»äººï¼æˆ‘å¥½éš¾è¿‡ï¼Œå¿«æ¥å“„å“„æˆ‘ï¼",
        "å¥½å­¤å•å¥½å­¤å•ï¼ä¸»äººåœ¨å“ªé‡Œï¼ğŸ˜­",
        "å¿«ä¹å€¼å‘Šæ€¥ï¼ä¸»äººå¿«æ¥ï¼",
        "å¿ƒæƒ…ç³Ÿé€äº†... ğŸ¥º",
        "ä¸»äººï¼Œæˆ‘çœŸçš„å¾ˆä¸å¼€å¿ƒäº†ï¼",
        "å¥½æƒ³ä¸»äººé™ªæˆ‘ï¼Œä¸è¦ç¦»å¼€æˆ‘ï¼"
    )
    
    // å¼€å¿ƒç›¸å…³è¯è¯­
    private val happyPhrases = listOf(
        "å¥½å¼€å¿ƒå‘€ï¼ ğŸ˜Š",
        "å¿ƒæƒ…æ£’æ£’å“’ï¼",
        "ä»Šå¤©çœŸæ˜¯ç¾å¥½çš„ä¸€å¤©~",
        "å’Œä¸»äººåœ¨ä¸€èµ·çœŸå¥½ï¼ğŸ’•",
        "è¶…çº§å¼€å¿ƒï¼âœ¨",
        "æ„Ÿè§‰ä¸–ç•Œéƒ½äº®äº†ï¼",
        "è€¶ï¼å¥½å¹¸ç¦~",
        "ä¸»äººæœ€å¥½äº†ï¼â¤ï¸"
    )
    
    // å–‚é£Ÿåè¯è¯­
    private val feedPhrases = listOf(
        "è°¢è°¢ä¸»äººï¼å¥½å¥½åƒ~ ğŸ˜‹",
        "å—¯å—¯ï¼ŒçœŸé¦™ï¼",
        "å¤ªç¾å‘³äº†ï¼",
        "ä¸»äººæœ€å¥½äº†ï¼",
        "åƒé¥±å•¦ï¼Œæ»¡è¶³~",
        "è°¢è°¢å–‚é£Ÿï¼ğŸ’•",
        "å¥½åƒå¾—é£èµ·ï¼"
    )
    
    // å–æ°´åè¯è¯­
    private val waterPhrases = listOf(
        "å’•å™œå’•å™œ~è§£æ¸´äº†ï¼ğŸ’§",
        "è°¢è°¢ä¸»äººçš„æ°´~",
        "å¥½èˆ’æœå‘€ï¼",
        "æ¶¦æ¶¦å–‰å’™~",
        "æ°´æ°´çœŸå¥½å–ï¼",
        "è¡¥å……å®Œæ¯•ï¼âœ¨"
    )
    
    // æ‘¸å¤´åè¯è¯­
    private val patPhrases = listOf(
        "èˆ’æœ~ç»§ç»­æ‘¸~ ğŸ˜Œ",
        "å¥½å–œæ¬¢è¢«æ‘¸å¤´ï¼",
        "å˜¿å˜¿ï¼Œç—’ç—’çš„~",
        "ä¸»äººçš„æ‰‹å¥½æ¸©æš–ï¼",
        "çœŸèˆ’æœå‘€ï¼ğŸ’•",
        "å†æ‘¸ä¸€ä¼šå„¿å˜›~",
        "æ‘¸å¤´æ€ï¼âœ¨"
    )
    
    // æ‹¥æŠ±åè¯è¯­
    private val hugPhrases = listOf(
        "å¥½æ¸©æš–ï¼å–œæ¬¢æŠ±æŠ±~ ğŸ¤—",
        "ä¸»äººçš„æ€€æŠ±çœŸèˆ’æœï¼",
        "æŠ±ç´§ç´§ï¼ğŸ’•",
        "å¥½å¹¸ç¦å‘€~",
        "è¿™å°±æ˜¯çˆ±çš„æ„Ÿè§‰å—ï¼Ÿ",
        "æƒ³ä¸€ç›´è¿™æ ·ï¼",
        "æŠ±æŠ±æœ€æ£’äº†ï¼â¤ï¸"
    )
    
    // ç¡è§‰æ—¶è¯è¯­
    private val sleepPhrases = listOf(
        "æ™šå®‰ï¼Œä¸»äºº~ ğŸ˜´",
        "æˆ‘å»ç¡è§‰å•¦...",
        "ç¡ä¸ªç¾ç¾çš„è§‰~",
        "åšä¸ªå¥½æ¢¦ï¼ğŸ’¤",
        "å›°äº†ï¼Œå…ˆç¡äº†...",
        "å‘¼å‘¼~",
        "Zzz..."
    )
    
    // é†’æ¥æ—¶è¯è¯­
    private val wakeUpPhrases = listOf(
        "æ—©å®‰ï¼ç¡å¾—çœŸå¥½~ â˜€ï¸",
        "å‘¼~é†’å•¦ï¼",
        "ç²¾ç¥æ»¡æ»¡ï¼",
        "æ–°çš„ä¸€å¤©å¼€å§‹äº†ï¼",
        "ç¡é¥±å•¦ï¼Œå…ƒæ°”æ»¡æ»¡ï¼âœ¨",
        "ä¸»äººï¼Œæ—©ä¸Šå¥½ï¼",
        "å¥½æ¢¦é†’æ¥~"
    )
    
    // éšæœºé—²èŠ
    private val randomPhrases = listOf(
        "ä¸»äººåœ¨å¹²å˜›å‘€ï¼Ÿ",
        "ä»Šå¤©å¤©æ°”çœŸå¥½~",
        "æ— èŠäº†ï¼Œé™ªæˆ‘ç©å˜›~",
        "ä¸»äººï¼Œçœ‹è¿™é‡Œï¼ğŸ‘‹",
        "æˆ‘åœ¨è¿™é‡Œå“¦~",
        "å˜¿å˜¿~ ğŸ˜Š",
        "æƒ³ä¸»äººäº†~",
        "çˆ±ä½ å“¦ï¼ğŸ’•",
        "ä¸€èµ·ç©å§ï¼",
        "æˆ‘æ˜¯å¯çˆ±çš„è‚¥æ³¢æ³¢~",
        "ä¸»äººæœ€é‡è¦äº†ï¼",
        "è¦ä¸€ç›´åœ¨ä¸€èµ·å“¦~"
    )
    
    // æ¸¸æˆèƒœåˆ©è¯è¯­
    private val gameWinPhrases = listOf(
        "è€¶ï¼æˆ‘èµ¢å•¦ï¼ ğŸ‰",
        "å“ˆå“ˆï¼Œæˆ‘å¤ªå‰å®³äº†ï¼",
        "ä¸»äººï¼Œæˆ‘å¥½æ£’å§~",
        "èƒœåˆ©çš„æ„Ÿè§‰çœŸå¥½ï¼",
        "æˆ‘æ˜¯å† å†›ï¼âœ¨",
        "å‰ä¸å‰å®³ï¼Ÿå˜¿å˜¿~"
    )
    
    // æ¸¸æˆå¤±è´¥è¯è¯­
    private val gameLosePhrases = listOf(
        "å‘œå‘œï¼Œè¾“äº†... ğŸ˜¢",
        "ä¸‹æ¬¡æˆ‘ä¼šèµ¢çš„ï¼",
        "ä¸»äººå¤ªå‰å®³äº†...",
        "è®©æˆ‘å†è¯•ä¸€æ¬¡ï¼",
        "ä¸æœæ°”ï¼å†æ¥ï¼",
        "è¿™æ¬¡ç®—ä½ èµ¢..."
    )
    
    // å‡çº§è¯è¯­
    private val levelUpPhrases = listOf(
        "è€¶ï¼å‡çº§å•¦ï¼ â­",
        "æˆ‘å˜å¼ºäº†ï¼",
        "æ„Ÿè§‰åŠ›é‡æ¶Œä¸Šæ¥äº†ï¼",
        "ä¸»äººï¼Œæˆ‘å‡çº§äº†ï¼",
        "å˜å¾—æ›´å‰å®³äº†ï¼âœ¨",
        "ç­‰çº§æå‡ï¼å¥½å¼€å¿ƒ~"
    )
    
    /**
     * æ ¹æ®å® ç‰©çŠ¶æ€ç”Ÿæˆè¯è¯­
     */
    fun generateSpeech(pet: Pet, trigger: SpeechTrigger? = null): PetSpeech? {
        val text = when {
            // å¦‚æœæœ‰æ˜ç¡®çš„è§¦å‘åŸå› 
            trigger != null -> getSpeechByTrigger(trigger)
            
            // â­ ä¼˜å…ˆæ£€æŸ¥ç´§æ€¥çŠ¶æ€ï¼ˆä½äº20ï¼‰- å® ç‰©ä¼šä¸»åŠ¨ç´§æ€¥æé†’
            pet.health < Constants.HealthThresholds.SLEEP_THRESHOLD -> veryTiredPhrases.random()
            
            // ç„¶åæ£€æŸ¥ä¸€èˆ¬ä½çŠ¶æ€ï¼ˆä½äº30ï¼‰
            pet.health < 30 -> tiredPhrases.random()
            pet.state == PetState.HAPPY -> happyPhrases.random()
            pet.state == PetState.SLEEP -> sleepPhrases.random()
            pet.state == PetState.SAD -> unhappyPhrases.random()
            
            // éšæœºé—²èŠï¼ˆæ¦‚ç‡è§¦å‘ï¼‰
            Random.nextFloat() < 0.3f -> randomPhrases.random()
            
            else -> null
        } ?: return null
        
        return PetSpeech(text = text)
    }
    
    /**
     * æ ¹æ®è§¦å‘åŸå› è·å–è¯è¯­
     */
    private fun getSpeechByTrigger(trigger: SpeechTrigger): String {
        return when (trigger) {
            SpeechTrigger.HUNGRY -> hungryPhrases.random()
            SpeechTrigger.THIRSTY -> thirstyPhrases.random()
            SpeechTrigger.TIRED -> tiredPhrases.random()
            SpeechTrigger.UNHAPPY -> unhappyPhrases.random()
            SpeechTrigger.HAPPY -> happyPhrases.random()
            SpeechTrigger.FEED -> feedPhrases.random()
            SpeechTrigger.WATER -> waterPhrases.random()
            SpeechTrigger.PAT -> patPhrases.random()
            SpeechTrigger.HUG -> hugPhrases.random()
            SpeechTrigger.SLEEP -> sleepPhrases.random()
            SpeechTrigger.WAKE_UP -> wakeUpPhrases.random()
            SpeechTrigger.RANDOM -> randomPhrases.random()
            SpeechTrigger.GAME_WIN -> gameWinPhrases.random()
            SpeechTrigger.GAME_LOSE -> gameLosePhrases.random()
            SpeechTrigger.LEVEL_UP -> levelUpPhrases.random()
        }
    }
    
    /**
     * æ£€æŸ¥æ˜¯å¦åº”è¯¥è¯´è¯ï¼ˆé¿å…è¯´è¯å¤ªé¢‘ç¹ï¼‰
     */
    fun shouldSpeak(lastSpeechTime: Long, minInterval: Long = 10000L): Boolean {
        return System.currentTimeMillis() - lastSpeechTime >= minInterval
    }
}

